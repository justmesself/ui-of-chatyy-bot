<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ISTARC Inspired Vintage-Modern Chat</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500&family=Roboto+Slab:wght@300;400&family=Exo+2:wght@300;400&display=swap" rel="stylesheet">
    <style>
        /* ===== CSS RESET & ROOT VARIABLES ===== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            transition: background-color 0.4s ease, border-color 0.4s ease;
        }

        :root {
            /* Light Theme (Default) - Vintage Modern */
            --primary-bg: #f8f5f1;
            --secondary-bg: #ffffff;
            --accent-color: #2a4b7c;
            --accent-light: #5a7ca8;
            --secondary-color: #7b3c8e;
            --text-color: #333333;
            --text-light: #666666;
            --border-color: #d1c7b7;
            --message-user-bg: #e3eeff;
            --message-user-border: #b8d4ff;
            --message-ai-bg: #f0f0f0;
            --message-ai-border: #d9d9d9;
            --input-bg: #ffffff;
            --shadow: rgba(0, 0, 0, 0.08);
            --gear-color: #2a4b7c;
            --logo-opacity: 0.07;
            --history-bg: rgba(255, 255, 255, 0.85);
        }

        .dark-theme {
            /* Dark Theme - Vintage Dark */
            --primary-bg: #1a1a2e;
            --secondary-bg: #16213e;
            --accent-color: #6d8dd7;
            --accent-light: #8fa8e6;
            --secondary-color: #b57edc;
            --text-color: #e6e6e6;
            --text-light: #aaaaaa;
            --border-color: #2d3a5a;
            --message-user-bg: rgba(109, 141, 215, 0.25);
            --message-user-border: #4a6bc3;
            --message-ai-bg: rgba(255, 255, 255, 0.07);
            --message-ai-border: #3a4a6b;
            --input-bg: #0f1525;
            --shadow: rgba(0, 0, 0, 0.25);
            --gear-color: #8fa8e6;
            --logo-opacity: 0.05;
            --history-bg: rgba(22, 33, 62, 0.9);
        }

        body {
            font-family: 'Roboto Slab', 'Segoe UI', serif;
            background-color: var(--primary-bg);
            color: var(--text-color);
            min-height: 100vh;
            overflow-x: hidden;
            background-image: 
                radial-gradient(circle at 15% 50%, rgba(42, 75, 124, 0.03) 0%, transparent 55%),
                radial-gradient(circle at 85% 30%, rgba(123, 60, 142, 0.03) 0%, transparent 55%);
        }

        /* ===== MAIN LAYOUT CONTAINER ===== */
        .app-container {
            display: flex;
            height: 100vh;
            max-width: 1800px;
            margin: 0 auto;
            position: relative;
        }

        /* ===== HEADER / LOGO SECTION ===== */
        .header-logo {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 5;
            width: 20vw; /* Takes about 1/5th of screen width */
            max-width: 220px;
            min-width: 150px;
            text-align: center;
            pointer-events: none;
        }

        .logo-background {
            font-family: 'Orbitron', sans-serif;
            font-weight: 500;
            font-size: 2.8rem;
            color: var(--accent-color);
            opacity: var(--logo-opacity);
            letter-spacing: 3px;
            text-transform: uppercase;
            filter: blur(0.7px);
            user-select: none;
        }

        /* ===== THEME & HISTORY TOGGLE (Hamburger/Slide) ===== */
        .utility-controls {
            position: absolute;
            top: 25px;
            right: 25px;
            z-index: 100;
            display: flex;
            flex-direction: column;
            align-items: flex-end;
        }

        .theme-toggle-wrapper {
            position: relative;
            margin-bottom: 15px;
        }

        #themeToggle {
            width: 50px;
            height: 24px;
            background: var(--border-color);
            border-radius: 12px;
            border: none;
            cursor: pointer;
            position: relative;
            outline: none;
            transition: all 0.3s cubic-bezier(0.68, -0.55, 0.27, 1.55);
            box-shadow: 0 2px 5px var(--shadow);
        }

        #themeToggle:hover {
            width: 100px;
        }

        #themeToggle:hover .toggle-slider {
            transform: translateX(36px) rotate(180deg);
        }

        #themeToggle:hover::after {
            content: 'Theme';
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            font-family: 'Exo 2', sans-serif;
            font-size: 0.7rem;
            color: var(--text-light);
            opacity: 0.8;
        }

        .toggle-slider {
            position: absolute;
            top: 2px;
            left: 2px;
            width: 20px;
            height: 20px;
            background: var(--accent-color);
            border-radius: 50%;
            transition: transform 0.4s cubic-bezier(0.68, -0.55, 0.27, 1.55);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 0.7rem;
        }

        .theme-options {
            position: absolute;
            top: 40px;
            right: 0;
            background: var(--secondary-bg);
            border: 1px solid var(--border-color);
            border-radius: 10px;
            padding: 12px;
            width: 180px;
            box-shadow: 0 8px 20px var(--shadow);
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px);
            transition: all 0.3s ease;
            z-index: 101;
        }

        .theme-toggle-wrapper:hover .theme-options {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        .theme-options label {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 10px;
            font-family: 'Exo 2', sans-serif;
            font-size: 0.85rem;
            cursor: pointer;
            padding: 5px 8px;
            border-radius: 5px;
        }

        .theme-options label:hover {
            background-color: rgba(0, 0, 0, 0.03);
        }

        .theme-options label:last-child {
            margin-bottom: 0;
        }

        .theme-options input[type="checkbox"] {
            accent-color: var(--accent-color);
        }

        .theme-options hr {
            margin: 8px 0;
            border: none;
            border-top: 1px solid var(--border-color);
        }

        /* ===== CHAT HISTORY SIDEBAR (Right Side) ===== */
        .chat-history-sidebar {
            width: 280px;
            background-color: var(--history-bg);
            border-left: 1px solid var(--border-color);
            padding: 80px 20px 20px 20px;
            overflow-y: auto;
            backdrop-filter: blur(5px);
            transform: translateX(100%);
            transition: transform 0.5s cubic-bezier(0.68, -0.55, 0.27, 1.55);
            box-shadow: -5px 0 15px var(--shadow);
            z-index: 10;
            position: relative;
        }

        .chat-history-sidebar.active {
            transform: translateX(0);
        }

        .history-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border-color);
        }

        .history-header h3 {
            font-family: 'Exo 2', sans-serif;
            font-size: 1.2rem;
            color: var(--accent-color);
        }

        .close-history {
            background: none;
            border: none;
            color: var(--text-light);
            cursor: pointer;
            font-size: 1.2rem;
            transition: color 0.2s;
        }

        .close-history:hover {
            color: var(--accent-color);
        }

        .chat-history-list {
            list-style: none;
        }

        .history-item {
            padding: 12px 15px;
            margin-bottom: 10px;
            background: var(--secondary-bg);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.25s ease;
            font-family: 'Exo 2', sans-serif;
            font-size: 0.9rem;
        }

        .history-item:hover {
            border-color: var(--accent-light);
            transform: translateX(-5px);
            box-shadow: 3px 3px 8px var(--shadow);
        }

        .history-item.active {
            border-color: var(--accent-color);
            background-color: rgba(42, 75, 124, 0.08);
        }

        .history-date {
            font-size: 0.75rem;
            color: var(--text-light);
            margin-top: 4px;
        }

        .empty-history {
            text-align: center;
            color: var(--text-light);
            font-style: italic;
            padding: 30px 10px;
            font-size: 0.9rem;
        }

        /* ===== MAIN CHAT AREA ===== */
        .main-chat-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            padding: 80px 20px 20px 20px;
            position: relative;
        }

        .chat-messages-container {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid var(--border-color);
            border-radius: 16px;
            background-color: var(--secondary-bg);
            box-shadow: inset 0 2px 6px var(--shadow);
            scroll-behavior: smooth;
        }

        /* Custom scrollbar for chat */
        .chat-messages-container::-webkit-scrollbar {
            width: 8px;
        }

        .chat-messages-container::-webkit-scrollbar-track {
            background: transparent;
            border-radius: 4px;
        }

        .chat-messages-container::-webkit-scrollbar-thumb {
            background: var(--border-color);
            border-radius: 4px;
        }

        .chat-messages-container::-webkit-scrollbar-thumb:hover {
            background: var(--accent-light);
        }

        /* ===== MESSAGE STYLES (Square-cut bubbles) ===== */
        .message {
            display: flex;
            margin-bottom: 22px;
            max-width: 78%;
            animation: messageAppear 0.35s cubic-bezier(0.18, 0.89, 0.32, 1.28);
        }

        @keyframes messageAppear {
            from { opacity: 0; transform: translateY(15px) scale(0.97); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }

        .message.user {
            margin-left: auto;
            justify-content: flex-end;
        }

        .message-content {
            padding: 16px 20px;
            position: relative;
            line-height: 1.5;
            word-wrap: break-word;
            font-size: 0.95rem;
            /* Square cut from two corners */
            border-radius: 20px 20px 20px 4px;
            box-shadow: 0 3px 10px var(--shadow);
            border: 1px solid;
        }

        .message.user .message-content {
            background-color: var(--message-user-bg);
            border-color: var(--message-user-border);
            border-radius: 20px 4px 20px 20px; /* Different cut corners */
        }

        .message.assistant .message-content {
            background-color: var(--message-ai-bg);
            border-color: var(--message-ai-border);
        }

        .message-sender {
            font-family: 'Exo 2', sans-serif;
            font-weight: 500;
            font-size: 0.85rem;
            margin-bottom: 6px;
            color: var(--accent-color);
            display: flex;
            align-items: center;
        }

        .message-sender i {
            margin-right: 8px;
            font-size: 0.9rem;
        }

        .message-time {
            font-size: 0.75rem;
            color: var(--text-light);
            text-align: right;
            margin-top: 8px;
        }

        .message.user .message-time {
            text-align: left;
        }

        /* File attachment style */
        .file-attachment {
            display: inline-flex;
            align-items: center;
            margin-top: 10px;
            padding: 8px 12px;
            background-color: rgba(255, 255, 255, 0.4);
            border-radius: 8px;
            border: 1px dashed var(--border-color);
            cursor: pointer;
            transition: all 0.2s ease;
            max-width: 250px;
        }

        .message.user .file-attachment {
            background-color: rgba(255, 255, 255, 0.6);
        }

        .file-attachment:hover {
            border-color: var(--accent-color);
            background-color: rgba(42, 75, 124, 0.08);
            transform: translateY(-2px);
        }

        .file-attachment i {
            margin-right: 10px;
            color: var(--accent-color);
            font-size: 1.2rem;
        }

        .file-name {
            font-size: 0.85rem;
            flex: 1;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .file-size {
            font-size: 0.75rem;
            color: var(--text-light);
            margin-left: 10px;
        }

        /* ===== SPECIAL ANIMATIONS ===== */
        /* Loading Animation (Orbital Rings) */
        .loading-container {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 30px;
            margin: 20px 0;
        }

        .orbital-loader {
            position: relative;
            width: 80px;
            height: 80px;
        }

        .orbital-ring {
            position: absolute;
            border-radius: 50%;
            border: 3px solid transparent;
            animation: spin 2s linear infinite;
        }

        .ring-1 {
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            border-top: 3px solid var(--accent-color);
            animation-delay: 0s;
        }

        .ring-2 {
            top: 10px;
            left: 10px;
            right: 10px;
            bottom: 10px;
            border-top: 3px solid var(--secondary-color);
            animation-delay: 0.1s;
        }

        .ring-3 {
            top: 20px;
            left: 20px;
            right: 20px;
            bottom: 20px;
            border-top: 3px solid var(--accent-light);
            animation-delay: 0.2s;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Typing Indicator (Spinning Gear) */
        .typing-indicator {
            display: inline-flex;
            align-items: center;
            padding: 15px 20px;
            background-color: var(--message-ai-bg);
            border: 1px solid var(--message-ai-border);
            border-radius: 20px 20px 20px 4px;
            margin-bottom: 22px;
            max-width: 180px;
        }

        .gear-container {
            position: relative;
            width: 32px;
            height: 32px;
            margin-right: 15px;
        }

        .gear {
            position: absolute;
            font-size: 32px;
            color: var(--gear-color);
            animation: gearSpin 4s linear infinite;
        }

        .gear-small {
            font-size: 22px;
            top: 5px;
            left: -10px;
            animation: gearSpinReverse 3s linear infinite;
            opacity: 0.8;
        }

        @keyframes gearSpin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes gearSpinReverse {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(-360deg); }
        }

        .typing-text {
            font-family: 'Exo 2', sans-serif;
            font-size: 0.9rem;
            color: var(--text-light);
        }

        /* Error Animation (Bouncing Funny Text) */
        .error-message {
            background-color: rgba(215, 90, 90, 0.1);
            border: 1px solid rgba(215, 90, 90, 0.3);
            border-radius: 12px;
            padding: 15px;
            margin: 15px 0;
            text-align: center;
            animation: bounceError 0.8s cubic-bezier(0.68, -0.55, 0.27, 1.55);
        }

        @keyframes bounceError {
            0%, 100% { transform: translateY(0); }
            25% { transform: translateY(-10px); }
            50% { transform: translateY(5px); }
            75% { transform: translateY(-3px); }
        }

        .error-icon {
            font-size: 1.8rem;
            color: #d75a5a;
            margin-bottom: 8px;
        }

        .error-text {
            font-family: 'Exo 2', sans-serif;
            color: #d75a5a;
        }

        /* ===== INPUT AREA ===== */
        .chat-input-container {
            display: flex;
            padding: 20px;
            background-color: var(--secondary-bg);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            box-shadow: 0 4px 12px var(--shadow);
            align-items: flex-end;
        }

        .input-wrapper {
            flex: 1;
            position: relative;
            margin-right: 15px;
        }

        #messageInput {
            width: 100%;
            min-height: 60px;
            max-height: 120px;
            padding: 18px 50px 18px 20px;
            background-color: var(--input-bg);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            color: var(--text-color);
            font-family: 'Roboto Slab', serif;
            font-size: 1rem;
            resize: none;
            outline: none;
            transition: all 0.3s ease;
            line-height: 1.5;
        }

        #messageInput:focus {
            border-color: var(--accent-color);
            box-shadow: 0 0 0 3px rgba(42, 75, 124, 0.2);
        }

        #messageInput::placeholder {
            color: var(--text-light);
        }

        .input-actions {
            position: absolute;
            right: 15px;
            bottom: 15px;
            display: flex;
            gap: 12px;
        }

        .input-action-btn {
            background: none;
            border: none;
            color: var(--text-light);
            cursor: pointer;
            font-size: 1.2rem;
            transition: all 0.25s cubic-bezier(0.68, -0.55, 0.27, 1.55);
            padding: 5px;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .input-action-btn:hover {
            color: var(--accent-color);
            transform: translateY(-3px) scale(1.1);
            background-color: rgba(42, 75, 124, 0.08);
        }

        .input-action-btn:active {
            transform: translateY(0) scale(0.98);
            transition: transform 0.1s;
        }

        /* Emoji Picker */
        .emoji-picker-container {
            position: absolute;
            bottom: 60px;
            right: 0;
            background: var(--secondary-bg);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 15px;
            width: 250px;
            box-shadow: 0 10px 25px var(--shadow);
            z-index: 50;
            opacity: 0;
            visibility: hidden;
            transform: translateY(10px);
            transition: all 0.3s ease;
        }

        .emoji-picker-container.active {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        .emoji-category {
            margin-bottom: 12px;
            font-family: 'Exo 2', sans-serif;
            font-size: 0.8rem;
            color: var(--accent-color);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .emoji-grid {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 8px;
            margin-bottom: 15px;
        }

        .emoji-btn {
            background: none;
            border: none;
            font-size: 1.4rem;
            cursor: pointer;
            padding: 5px;
            border-radius: 6px;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .emoji-btn:hover {
            background-color: rgba(42, 75, 124, 0.1);
            transform: scale(1.2);
        }

        /* Send & Action Buttons */
        .action-buttons {
            display: flex;
            flex-direction: column;
            gap: 12px;
            width: 120px;
        }

        .send-button {
            height: 60px;
            background: linear-gradient(135deg, var(--accent-color), var(--secondary-color));
            border: none;
            border-radius: 12px;
            color: white;
            font-family: 'Exo 2', sans-serif;
            font-weight: 500;
            font-size: 1rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            transition: all 0.3s cubic-bezier(0.68, -0.55, 0.27, 1.55);
            box-shadow: 0 4px 10px rgba(42, 75, 124, 0.3);
        }

        .send-button:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 18px rgba(42, 75, 124, 0.4);
            background: linear-gradient(135deg, var(--accent-light), var(--secondary-color));
        }

        .send-button:active {
            transform: translateY(0);
            box-shadow: 0 2px 5px rgba(42, 75, 124, 0.3);
            transition: transform 0.1s;
        }

        .send-button i {
            font-size: 1.2rem;
            transition: transform 0.3s ease;
        }

        .send-button:hover i {
            transform: translateX(3px);
        }

        .copy-chat-button {
            height: 50px;
            background-color: transparent;
            border: 1px solid var(--accent-color);
            border-radius: 10px;
            color: var(--accent-color);
            font-family: 'Exo 2', sans-serif;
            font-size: 0.9rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: all 0.3s ease;
        }

        .copy-chat-button:hover {
            background-color: rgba(42, 75, 124, 0.1);
            transform: translateY(-3px);
        }

        .copy-chat-button:active {
            transform: translateY(0);
        }

        .copy-chat-button.copied {
            background-color: rgba(42, 75, 124, 0.2);
            color: var(--text-color);
        }

        .copy-chat-button.copied i {
            animation: copyPulse 0.5s ease;
        }

        @keyframes copyPulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.3); }
            100% { transform: scale(1); }
        }

        /* ===== FILE UPLOAD & PREVIEW ===== */
        .file-upload-progress {
            margin-top: 15px;
            padding: 12px;
            background-color: var(--secondary-bg);
            border: 1px solid var(--border-color);
            border-radius: 10px;
            display: none;
        }

        .progress-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-family: 'Exo 2', sans-serif;
            font-size: 0.9rem;
        }

        .progress-bar {
            height: 6px;
            background-color: rgba(0, 0, 0, 0.1);
            border-radius: 3px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-color), var(--secondary-color));
            border-radius: 3px;
            width: 0%;
            transition: width 0.3s ease;
        }

        .progress-percentage {
            font-size: 0.8rem;
            color: var(--text-light);
            text-align: right;
            margin-top: 5px;
        }

        /* File Preview Modal */
        .file-preview-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            backdrop-filter: blur(5px);
        }

        .file-preview-modal.active {
            opacity: 1;
            visibility: visible;
        }

        .preview-content {
            background-color: var(--secondary-bg);
            border-radius: 16px;
            padding: 25px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow: auto;
            position: relative;
            border: 1px solid var(--border-color);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.3);
            animation: modalAppear 0.4s cubic-bezier(0.18, 0.89, 0.32, 1.28);
        }

        @keyframes modalAppear {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }

        .preview-close {
            position: absolute;
            top: 15px;
            right: 15px;
            background: none;
            border: none;
            color: var(--text-light);
            font-size: 1.5rem;
            cursor: pointer;
            transition: color 0.2s;
            z-index: 10;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }

        .preview-close:hover {
            color: var(--accent-color);
            background-color: rgba(0, 0, 0, 0.05);
        }

        .preview-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border-color);
        }

        .preview-icon {
            font-size: 2rem;
            color: var(--accent-color);
            margin-right: 15px;
        }

        .preview-file-info h4 {
            font-family: 'Exo 2', sans-serif;
            margin-bottom: 5px;
        }

        .preview-file-size {
            font-size: 0.9rem;
            color: var(--text-light);
        }

        .preview-body {
            padding: 15px 0;
        }

        .preview-image {
            max-width: 100%;
            border-radius: 8px;
            display: block;
            margin: 0 auto;
        }

        .preview-text {
            white-space: pre-wrap;
            font-family: monospace;
            background-color: rgba(0, 0, 0, 0.05);
            padding: 15px;
            border-radius: 8px;
            max-height: 300px;
            overflow-y: auto;
        }

        .preview-actions {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid var(--border-color);
        }

        .preview-btn {
            padding: 10px 20px;
            border-radius: 8px;
            border: 1px solid var(--border-color);
            background-color: transparent;
            color: var(--text-color);
            font-family: 'Exo 2', sans-serif;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .preview-btn.download {
            background-color: var(--accent-color);
            color: white;
            border: none;
        }

        .preview-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px var(--shadow);
        }

        /* ===== RESPONSIVE DESIGN ===== */
        @media (max-width: 1100px) {
            .chat-history-sidebar {
                position: fixed;
                top: 0;
                right: 0;
                height: 100vh;
                width: 320px;
                z-index: 500;
            }
            
            .message {
                max-width: 85%;
            }
            
            .action-buttons {
                width: 100px;
            }
        }

        @media (max-width: 768px) {
            .app-container {
                flex-direction: column;
            }
            
            .chat-history-sidebar {
                width: 100%;
                padding-top: 100px;
            }
            
            .main-chat-area {
                padding: 100px 15px 15px 15px;
            }
            
            .chat-input-container {
                flex-direction: column;
                gap: 15px;
            }
            
            .input-wrapper {
                margin-right: 0;
                margin-bottom: 10px;
            }
            
            .action-buttons {
                width: 100%;
                flex-direction: row;
            }
            
            .send-button, .copy-chat-button {
                flex: 1;
            }
            
            .message {
                max-width: 90%;
            }
            
            .header-logo {
                width: 30vw;
            }
            
            .logo-background {
                font-size: 2rem;
            }
            
            .utility-controls {
                top: 20px;
                right: 15px;
            }
        }

        @media (max-width: 480px) {
            .header-logo {
                width: 40vw;
            }
            
            .logo-background {
                font-size: 1.8rem;
            }
            
            .message-content {
                padding: 12px 16px;
            }
            
            .chat-input-container {
                padding: 15px;
            }
            
            #messageInput {
                min-height: 50px;
                padding: 14px 45px 14px 15px;
            }
            
            .input-actions {
                right: 10px;
                bottom: 12px;
                gap: 8px;
            }
            
            .emoji-picker-container {
                width: 200px;
                right: -50px;
            }
            
            .emoji-grid {
                grid-template-columns: repeat(5, 1fr);
            }
        }

        /* ===== CODE HIGHLIGHT SUPPORT ===== */
        .message-content pre {
            background-color: rgba(0, 0, 0, 0.05) !important;
            border-radius: 8px;
            padding: 12px;
            overflow-x: auto;
            margin: 10px 0;
            border: 1px solid rgba(0, 0, 0, 0.1);
        }

        .message-content code {
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            background-color: rgba(0, 0, 0, 0.05);
            padding: 2px 6px;
            border-radius: 4px;
            color: #d63384;
        }

        .message.user .message-content pre {
            background-color: rgba(255, 255, 255, 0.3) !important;
        }

        .message.user .message-content code {
            background-color: rgba(255, 255, 255, 0.4);
        }
    </style>
</head>
<body class="dark-theme">
    <!-- Main App Container -->
    <div class="app-container">
        
        <!-- Centered Logo -->
        <div class="header-logo">
            <div class="logo-background">ISTARC</div>
        </div>
        
        <!-- Theme & History Controls (Top Right) -->
        <div class="utility-controls">
            <div class="theme-toggle-wrapper">
                <button id="themeToggle" aria-label="Toggle theme">
                    <div class="toggle-slider"><i class="fas fa-adjust"></i></div>
                </button>
                <div class="theme-options">
                    <label>
                        <span>Dark Theme</span>
                        <input type="checkbox" id="darkThemeToggle" checked>
                    </label>
                    <label>
                        <span>Remember Chats</span>
                        <input type="checkbox" id="rememberChatsToggle">
                    </label>
                    <hr>
                    <label>
                        <span>New Chat</span>
                        <button id="newChatBtn" style="background:none; border:none; color:var(--accent-color); cursor:pointer;">
                            <i class="fas fa-plus"></i>
                        </button>
                    </label>
                </div>
            </div>
        </div>
        
        <!-- Main Chat Area -->
        <div class="main-chat-area">
            
            <!-- Chat Messages Container -->
            <div class="chat-messages-container" id="chatMessages">
                <!-- Initial messages loaded by JavaScript -->
                <div class="message assistant">
                    <div class="message-content">
                        <div class="message-sender"><i class="fas fa-robot"></i> ISTARC Assistant</div>
                        Welcome! Inspired by the ISTARC motto "Science in Creation, not Annihilation", I'm here to assist with your research and creative projects. How can I help you today?
                        <div class="message-time">10:00 AM</div>
                    </div>
                </div>
                
                <div class="message user">
                    <div class="message-content">
                        <div class="message-sender"><i class="fas fa-user"></i> You</div>
                        Can you explain the core principles mentioned on the ISTARC website?
                        <div class="file-attachment" data-file="istarc_principles.pdf" data-size="2.4 MB">
                            <i class="fas fa-file-pdf"></i>
                            <div class="file-name">istarc_principles.pdf</div>
                            <div class="file-size">2.4 MB</div>
                        </div>
                        <div class="message-time">10:02 AM</div>
                    </div>
                </div>
                
                <div class="message assistant">
                    <div class="message-content">
                        <div class="message-sender"><i class="fas fa-robot"></i> ISTARC Assistant</div>
                        Based on the ISTARC website, the core principles focus on spreading scientific awareness and promoting science-based thinking among students. The club organizes workshops, festivals, and events to enlighten students with the enigma of science.
                        <pre><code>// Example of promoting scientific thinking
function exploreScience(idea) {
    let hypothesis = formulateHypothesis(idea);
    let experiment = designExperiment(hypothesis);
    return analyzeResults(experiment);
}</code></pre>
                        <div class="message-time">10:03 AM</div>
                    </div>
                </div>
                
                <!-- Typing Indicator (Hidden by default) -->
                <div class="typing-indicator" id="typingIndicator" style="display: none;">
                    <div class="gear-container">
                        <div class="gear"><i class="fas fa-cog"></i></div>
                        <div class="gear gear-small"><i class="fas fa-cog"></i></div>
                    </div>
                    <div class="typing-text">Processing your query...</div>
                </div>
                
                <!-- Loading Animation Container -->
                <div class="loading-container" id="loadingContainer" style="display: none;">
                    <div class="orbital-loader">
                        <div class="orbital-ring ring-1"></div>
                        <div class="orbital-ring ring-2"></div>
                        <div class="orbital-ring ring-3"></div>
                    </div>
                </div>
                
                <!-- Error Message Container -->
                <div class="error-message" id="errorContainer" style="display: none;">
                    <div class="error-icon"><i class="fas fa-exclamation-triangle"></i></div>
                    <div class="error-text" id="errorText">Oops! Something went wrong. Try again!</div>
                </div>
            </div>
            
            <!-- File Upload Progress -->
            <div class="file-upload-progress" id="fileUploadProgress">
                <div class="progress-header">
                    <span>Uploading file</span>
                    <span id="fileName">document.pdf</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                <div class="progress-percentage" id="progressPercentage">0%</div>
            </div>
            
            <!-- Chat Input Area -->
            <div class="chat-input-container">
                <div class="input-wrapper">
                    <textarea id="messageInput" placeholder="Type your message here... (Press Enter to send, Shift+Enter for new line)" rows="1"></textarea>
                    <div class="input-actions">
                        <button class="input-action-btn" id="attachFileBtn" aria-label="Attach file">
                            <i class="fas fa-paperclip"></i>
                        </button>
                        <button class="input-action-btn" id="emojiPickerBtn" aria-label="Open emoji picker">
                            <i class="far fa-smile"></i>
                        </button>
                    </div>
                    
                    <!-- Emoji Picker -->
                    <div class="emoji-picker-container" id="emojiPicker">
                        <div class="emoji-category">Frequently Used</div>
                        <div class="emoji-grid" id="emojiGrid">
                            <!-- Emojis populated by JavaScript -->
                        </div>
                        <div class="emoji-category">Science & Tech</div>
                        <div class="emoji-grid" id="scienceEmojiGrid">
                            <!-- Science emojis populated by JavaScript -->
                        </div>
                    </div>
                </div>
                
                <div class="action-buttons">
                    <button class="send-button" id="sendButton">
                        <i class="fas fa-paper-plane"></i>
                        <span>Send</span>
                    </button>
                    <button class="copy-chat-button" id="copyChatButton">
                        <i class="far fa-copy"></i>
                        <span>Copy Chat</span>
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Chat History Sidebar (Initially hidden) -->
        <div class="chat-history-sidebar" id="chatHistorySidebar">
            <div class="history-header">
                <h3><i class="fas fa-history"></i> Chat History</h3>
                <button class="close-history" id="closeHistoryBtn" aria-label="Close history">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <ul class="chat-history-list" id="chatHistoryList">
                <!-- History items populated by JavaScript -->
                <li class="history-item active">
                    <div>ISTARC Discussion</div>
                    <div class="history-date">Today, 10:00 AM</div>
                </li>
                <li class="history-item">
                    <div>Science Project Ideas</div>
                    <div class="history-date">Yesterday, 3:45 PM</div>
                </li>
                <li class="history-item">
                    <div>Workshop Planning</div>
                    <div class="history-date">Dec 28, 2:30 PM</div>
                </li>
                <li class="history-item">
                    <div>Research Methodology</div>
                    <div class="history-date">Dec 25, 11:20 AM</div>
                </li>
            </ul>
            <div class="empty-history" id="emptyHistoryMessage" style="display: none;">
                <i class="fas fa-comment-slash" style="font-size: 2rem; margin-bottom: 10px; opacity: 0.5;"></i>
                <p>No chat history yet.<br>Start a conversation!</p>
            </div>
        </div>
    </div>
    
    <!-- File Preview Modal -->
    <div class="file-preview-modal" id="filePreviewModal">
        <div class="preview-content">
            <button class="preview-close" id="previewCloseBtn" aria-label="Close preview">
                <i class="fas fa-times"></i>
            </button>
            <div class="preview-header">
                <div class="preview-icon">
                    <i class="fas fa-file" id="previewFileIcon"></i>
                </div>
                <div class="preview-file-info">
                    <h4 id="previewFileName">document.pdf</h4>
                    <div class="preview-file-size" id="previewFileSize">2.4 MB</div>
                </div>
            </div>
            <div class="preview-body" id="previewBody">
                <!-- Preview content loaded dynamically -->
            </div>
            <div class="preview-actions">
                <button class="preview-btn" id="closePreviewBtn">Close</button>
                <button class="preview-btn download" id="downloadPreviewBtn">
                    <i class="fas fa-download"></i> Download
                </button>
            </div>
        </div>
    </div>

    <script>
        // ===== GLOBAL VARIABLES =====
        let currentTheme = 'dark';
        let rememberChats = false;
        let chatHistory = [];
        let currentFile = null;
        
        // Sample chat history data
        const sampleHistory = [
            { id: 1, title: "ISTARC Discussion", date: "Today, 10:00 AM", active: true },
            { id: 2, title: "Science Project Ideas", date: "Yesterday, 3:45 PM", active: false },
            { id: 3, title: "Workshop Planning", date: "Dec 28, 2:30 PM", active: false },
            { id: 4, title: "Research Methodology", date: "Dec 25, 11:20 AM", active: false }
        ];
        
        // Frequently used emojis
        const commonEmojis = ["ðŸ˜Š", "ðŸ˜‚", "ðŸ¤”", "ðŸ‘", "ðŸŽ‰", "ðŸš€", "ðŸ’¡", "âœ¨", "ðŸ”¥", "â¤ï¸", "ðŸ‘", "ðŸ™", "ðŸ‘€", "ðŸ“š", "ðŸ¤–"];
        
        // Science & tech emojis
        const scienceEmojis = ["ðŸ”¬", "âš—ï¸", "ðŸ§ª", "ðŸ§¬", "ðŸ”­", "ðŸ’»", "ðŸ“¡", "âš›ï¸", "ðŸ§®", "ðŸ”‹", "ðŸ’¾", "ðŸ§²", "ðŸŒ¡ï¸", "ðŸ§«", "ðŸ”"];

        // ===== DOM ELEMENT REFERENCES =====
        const themeToggle = document.getElementById('themeToggle');
        const darkThemeToggle = document.getElementById('darkThemeToggle');
        const rememberChatsToggle = document.getElementById('rememberChatsToggle');
        const newChatBtn = document.getElementById('newChatBtn');
        const chatHistorySidebar = document.getElementById('chatHistorySidebar');
        const chatHistoryList = document.getElementById('chatHistoryList');
        const emptyHistoryMessage = document.getElementById('emptyHistoryMessage');
        const closeHistoryBtn = document.getElementById('closeHistoryBtn');
        const chatMessages = document.getElementById('chatMessages');
        const messageInput = document.getElementById('messageInput');
        const sendButton = document.getElementById('sendButton');
        const attachFileBtn = document.getElementById('attachFileBtn');
        const emojiPickerBtn = document.getElementById('emojiPickerBtn');
        const emojiPicker = document.getElementById('emojiPicker');
        const emojiGrid = document.getElementById('emojiGrid');
        const scienceEmojiGrid = document.getElementById('scienceEmojiGrid');
        const copyChatButton = document.getElementById('copyChatButton');
        const typingIndicator = document.getElementById('typingIndicator');
        const loadingContainer = document.getElementById('loadingContainer');
        const errorContainer = document.getElementById('errorContainer');
        const errorText = document.getElementById('errorText');
        const fileUploadProgress = document.getElementById('fileUploadProgress');
        const progressFill = document.getElementById('progressFill');
        const progressPercentage = document.getElementById('progressPercentage');
        const fileName = document.getElementById('fileName');
        const filePreviewModal = document.getElementById('filePreviewModal');
        const previewCloseBtn = document.getElementById('previewCloseBtn');
        const closePreviewBtn = document.getElementById('closePreviewBtn');
        const downloadPreviewBtn = document.getElementById('downloadPreviewBtn');
        const previewFileName = document.getElementById('previewFileName');
        const previewFileSize = document.getElementById('previewFileSize');
        const previewFileIcon = document.getElementById('previewFileIcon');
        const previewBody = document.getElementById('previewBody');

        // ===== THEME MANAGEMENT =====
        function initializeTheme() {
            // Check for saved theme preference
            const savedTheme = localStorage.getItem('chatTheme');
            if (savedTheme) {
                currentTheme = savedTheme;
                darkThemeToggle.checked = (savedTheme === 'dark');
            }
            
            // Apply theme
            applyTheme(currentTheme);
            
            // Check for remember chats setting
            const savedRememberChats = localStorage.getItem('rememberChats');
            if (savedRememberChats) {
                rememberChats = (savedRememberChats === 'true');
                rememberChatsToggle.checked = rememberChats;
                
                // Show history sidebar if chats are being remembered
                if (rememberChats) {
                    chatHistorySidebar.classList.add('active');
                }
            }
            
            // Load chat history if enabled
            if (rememberChats) {
                loadChatHistory();
            }
        }
        
        function applyTheme(theme) {
            if (theme === 'dark') {
                document.body.classList.add('dark-theme');
                document.body.classList.remove('light-theme');
            } else {
                document.body.classList.remove('dark-theme');
                document.body.classList.add('light-theme');
            }
            currentTheme = theme;
            localStorage.setItem('chatTheme', theme);
        }
        
        function toggleTheme() {
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            applyTheme(newTheme);
            darkThemeToggle.checked = (newTheme === 'dark');
            
            // Show a subtle confirmation
            showTemporaryNotification(`Theme changed to ${newTheme} mode`);
        }
        
        function toggleRememberChats() {
            rememberChats = rememberChatsToggle.checked;
            localStorage.setItem('rememberChats', rememberChats);
            
            if (rememberChats) {
                // Show history sidebar
                chatHistorySidebar.classList.add('active');
                loadChatHistory();
                showTemporaryNotification("Chat history saving enabled");
            } else {
                // Hide history sidebar
                chatHistorySidebar.classList.remove('active');
                showTemporaryNotification("Chat history saving disabled");
            }
        }
        
        function loadChatHistory() {
            // In a real app, this would load from localStorage or an API
            chatHistory = [...sampleHistory];
            updateHistoryList();
        }
        
        function updateHistoryList() {
            chatHistoryList.innerHTML = '';
            
            if (chatHistory.length === 0) {
                emptyHistoryMessage.style.display = 'block';
                return;
            }
            
            emptyHistoryMessage.style.display = 'none';
            
            chatHistory.forEach(item => {
                const historyItem = document.createElement('li');
                historyItem.className = `history-item ${item.active ? 'active' : ''}`;
                historyItem.innerHTML = `
                    <div>${item.title}</div>
                    <div class="history-date">${item.date}</div>
                `;
                
                historyItem.addEventListener('click', () => {
                    // Remove active class from all items
                    document.querySelectorAll('.history-item').forEach(el => {
                        el.classList.remove('active');
                    });
                    
                    // Add active class to clicked item
                    historyItem.classList.add('active');
                    
                    // In a real app, this would load the selected chat
                    showTemporaryNotification(`Loading: ${item.title}`);
                });
                
                chatHistoryList.appendChild(historyItem);
            });
        }
        
        // ===== EMOJI PICKER =====
        function initializeEmojiPicker() {
            // Populate common emojis
            commonEmojis.forEach(emoji => {
                const emojiBtn = document.createElement('button');
                emojiBtn.className = 'emoji-btn';
                emojiBtn.textContent = emoji;
                emojiBtn.setAttribute('aria-label', `Emoji ${emoji}`);
                emojiBtn.addEventListener('click', () => insertEmoji(emoji));
                emojiGrid.appendChild(emojiBtn);
            });
            
            // Populate science emojis
            scienceEmojis.forEach(emoji => {
                const emojiBtn = document.createElement('button');
                emojiBtn.className = 'emoji-btn';
                emojiBtn.textContent = emoji;
                emojiBtn.setAttribute('aria-label', `Emoji ${emoji}`);
                emojiBtn.addEventListener('click', () => insertEmoji(emoji));
                scienceEmojiGrid.appendChild(emojiBtn);
            });
        }
        
        function insertEmoji(emoji) {
            const cursorPos = messageInput.selectionStart;
            const textBefore = messageInput.value.substring(0, cursorPos);
            const textAfter = messageInput.value.substring(cursorPos);
            
            messageInput.value = textBefore + emoji + textAfter;
            messageInput.focus();
            messageInput.selectionStart = cursorPos + emoji.length;
            messageInput.selectionEnd = cursorPos + emoji.length;
            
            // Close emoji picker after selection
            emojiPicker.classList.remove('active');
            
            // Auto-resize textarea
            autoResizeTextarea();
        }
        
        // ===== CHAT FUNCTIONALITY =====
        function autoResizeTextarea() {
            messageInput.style.height = 'auto';
            messageInput.style.height = (messageInput.scrollHeight) + 'px';
        }
        
        function addMessage(content, isUser = false, fileAttached = null) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${isUser ? 'user' : 'assistant'}`;
            
            const senderName = isUser ? 'You' : 'ISTARC Assistant';
            const senderIcon = isUser ? 'fa-user' : 'fa-robot';
            const currentTime = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            
            let fileHtml = '';
            if (fileAttached) {
                fileHtml = `
                    <div class="file-attachment" data-file="${fileAttached.name}" data-size="${fileAttached.size}">
                        <i class="fas fa-file-${fileAttached.type === 'pdf' ? 'pdf' : fileAttached.type === 'image' ? 'image' : 'alt'}"></i>
                        <div class="file-name">${fileAttached.name}</div>
                        <div class="file-size">${fileAttached.size}</div>
                    </div>
                `;
            }
            
            messageDiv.innerHTML = `
                <div class="message-content">
                    <div class="message-sender"><i class="fas ${senderIcon}"></i> ${senderName}</div>
                    ${content}
                    ${fileHtml}
                    <div class="message-time">${currentTime}</div>
                </div>
            `;
            
            chatMessages.appendChild(messageDiv);
            
            // Scroll to the new message
            chatMessages.scrollTop = chatMessages.scrollHeight;
            
            // Add click event to file attachment if present
            if (fileAttached) {
                const fileAttachment = messageDiv.querySelector('.file-attachment');
                fileAttachment.addEventListener('click', () => {
                    previewFile(fileAttached);
                });
            }
            
            return messageDiv;
        }
        
        function sendMessage() {
            const message = messageInput.value.trim();
            if (!message && !currentFile) return;
            
            // Add user message to chat
            addMessage(message, true, currentFile);
            
            // Clear input and reset file
            messageInput.value = '';
            currentFile = null;
            autoResizeTextarea();
            
            // Show typing indicator
            typingIndicator.style.display = 'flex';
            chatMessages.scrollTop = chatMessages.scrollHeight;
            
            // Simulate AI processing delay
            setTimeout(() => {
                typingIndicator.style.display = 'none';
                
                // Simulate occasional error
                if (Math.random() < 0.1) {
                    showError("Hmm, my circuits are feeling nostalgic! Let me try that again...");
                    return;
                }
                
                // Generate AI response
                const responses = [
                    "Based on ISTARC's focus on 'Science in Creation', I'd suggest exploring practical applications of that concept in your project.",
                    "The scientific method emphasized by ISTARC involves observation, hypothesis, experimentation, and analysis. How can we apply this to your question?",
                    "ISTARC organizes workshops and festivals to spread scientific awareness. Perhaps we could brainstorm a workshop idea on this topic?",
                    "Remember the ISTARC motto: 'Science in Creation, not Annihilation'. How can we create something valuable with this information?",
                    "As ISTARC promotes science-based thinking, let's analyze this logically and creatively."
                ];
                
                const randomResponse = responses[Math.floor(Math.random() * responses.length)];
                
                // Add AI response
                addMessage(randomResponse, false);
                
                // Update chat history if enabled
                if (rememberChats && chatHistory.length > 0) {
                    const currentChat = chatHistory.find(item => item.active);
                    if (currentChat) {
                        currentChat.date = `Today, ${new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}`;
                        updateHistoryList();
                    }
                }
                
            }, 1500 + Math.random() * 2000);
        }
        
        function showError(errorMessage) {
            errorText.textContent = errorMessage;
            errorContainer.style.display = 'block';
            
            // Scroll error into view
            chatMessages.scrollTop = chatMessages.scrollHeight;
            
            // Hide error after 5 seconds
            setTimeout(() => {
                errorContainer.style.display = 'none';
            }, 5000);
        }
        
        function showLoading() {
            loadingContainer.style.display = 'flex';
            chatMessages.scrollTop = chatMessages.scrollHeight;
            
            // Hide loading after a random time (simulating processing)
            setTimeout(() => {
                loadingContainer.style.display = 'none';
            }, 2000 + Math.random() * 2000);
        }
        
        function showTemporaryNotification(message) {
            // Create notification element
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                bottom: 30px;
                left: 50%;
                transform: translateX(-50%) translateY(100px);
                background-color: var(--accent-color);
                color: white;
                padding: 12px 24px;
                border-radius: 10px;
                z-index: 10000;
                font-family: 'Exo 2', sans-serif;
                box-shadow: 0 5px 15px rgba(0,0,0,0.2);
                transition: transform 0.4s cubic-bezier(0.68, -0.55, 0.27, 1.55);
                white-space: nowrap;
            `;
            notification.textContent = message;
            document.body.appendChild(notification);
            
            // Animate in
            setTimeout(() => {
                notification.style.transform = 'translateX(-50%) translateY(0)';
            }, 10);
            
            // Animate out and remove after 3 seconds
            setTimeout(() => {
                notification.style.transform = 'translateX(-50%) translateY(100px)';
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 400);
            }, 3000);
        }
        
        // ===== FILE HANDLING =====
        function handleFileSelect(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            currentFile = {
                name: file.name,
                size: formatFileSize(file.size),
                type: getFileType(file.name)
            };
            
            // Show upload progress
            simulateFileUpload(file);
            
            // Show notification
            showTemporaryNotification(`"${file.name}" attached`);
        }
        
        function simulateFileUpload(file) {
            fileUploadProgress.style.display = 'block';
            fileName.textContent = file.name;
            
            let progress = 0;
            const interval = setInterval(() => {
                progress += Math.random() * 15;
                if (progress > 100) progress = 100;
                
                progressFill.style.width = `${progress}%`;
                progressPercentage.textContent = `${Math.round(progress)}%`;
                
                if (progress >= 100) {
                    clearInterval(interval);
                    
                    // Hide progress bar after a delay
                    setTimeout(() => {
                        fileUploadProgress.style.display = 'none';
                        progressFill.style.width = '0%';
                        progressPercentage.textContent = '0%';
                    }, 1000);
                }
            }, 200);
        }
        
        function previewFile(file) {
            previewFileName.textContent = file.name;
            previewFileSize.textContent = file.size;
            
            // Set appropriate icon
            let iconClass = 'fa-file';
            if (file.type === 'pdf') iconClass = 'fa-file-pdf';
            if (file.type === 'image') iconClass = 'fa-file-image';
            if (file.type === 'text') iconClass = 'fa-file-alt';
            
            previewFileIcon.className = `fas ${iconClass}`;
            
            // Generate preview content
            let previewContent = '';
            if (file.type === 'image') {
                previewContent = `<img src="https://via.placeholder.com/500x300/2a4b7c/ffffff?text=Preview+of+${encodeURIComponent(file.name)}" alt="${file.name}" class="preview-image">`;
            } else if (file.type === 'pdf') {
                previewContent = `<div class="preview-text">[PDF Preview] "${file.name}"\n\nThis is a simulated preview of the PDF document. In a real application, this would show actual PDF content.\n\nFile size: ${file.size}\n\nISTARC documents often contain research papers, workshop materials, and scientific findings.</div>`;
            } else {
                previewContent = `<div class="preview-text">File: ${file.name}\nType: ${file.type.toUpperCase()}\nSize: ${file.size}\n\nThis file has been attached to the chat. You can download it for offline access.</div>`;
            }
            
            previewBody.innerHTML = previewContent;
            
            // Show modal
            filePreviewModal.classList.add('active');
        }
        
        function formatFileSize(bytes) {
            if (bytes < 1024) return bytes + ' bytes';
            else if (bytes < 1048576) return (bytes / 1024).toFixed(1) + ' KB';
            else return (bytes / 1048576).toFixed(1) + ' MB';
        }
        
        function getFileType(filename) {
            const ext = filename.split('.').pop().toLowerCase();
            if (['jpg', 'jpeg', 'png', 'gif', 'bmp', 'svg'].includes(ext)) return 'image';
            if (['pdf'].includes(ext)) return 'pdf';
            if (['txt', 'doc', 'docx', 'md'].includes(ext)) return 'text';
            return 'other';
        }
        
        // ===== CHAT COPY FUNCTIONALITY =====
        function copyChatToClipboard() {
            const messages = document.querySelectorAll('.message-content');
            let chatText = "=== ISTARC Chat Transcript ===\n\n";
            
            messages.forEach(message => {
                const sender = message.querySelector('.message-sender').textContent;
                const content = message.querySelector('div:not(.message-sender):not(.message-time):not(.file-attachment)').textContent;
                const time = message.querySelector('.message-time').textContent;
                
                chatText += `${sender} (${time}):\n${content}\n\n`;
            });
            
            navigator.clipboard.writeText(chatText).then(() => {
                // Visual feedback
                copyChatButton.classList.add('copied');
                copyChatButton.innerHTML = '<i class="fas fa-check"></i><span>Copied!</span>';
                
                showTemporaryNotification("Chat copied to clipboard!");
                
                setTimeout(() => {
                    copyChatButton.classList.remove('copied');
                    copyChatButton.innerHTML = '<i class="far fa-copy"></i><span>Copy Chat</span>';
                }, 2000);
            }).catch(err => {
                showError("Failed to copy chat: " + err);
            });
        }
        
        // ===== EVENT LISTENERS =====
        function initializeEventListeners() {
            // Theme toggle
            themeToggle.addEventListener('click', toggleTheme);
            darkThemeToggle.addEventListener('change', () => {
                if (darkThemeToggle.checked !== (currentTheme === 'dark')) {
                    toggleTheme();
                }
            });
            
            // Remember chats toggle
            rememberChatsToggle.addEventListener('change', toggleRememberChats);
            
            // New chat button
            newChatBtn.addEventListener('click', () => {
                // Clear current chat
                const messages = chatMessages.querySelectorAll('.message:not(:first-child)');
                messages.forEach(msg => msg.remove());
                
                // Reset input
                messageInput.value = '';
                currentFile = null;
                
                // Show notification
                showTemporaryNotification("New chat started");
                
                // Update history
                if (rememberChats) {
                    chatHistory.forEach(item => item.active = false);
                    chatHistory.unshift({
                        id: chatHistory.length + 1,
                        title: `New Chat ${new Date().getHours()}:${new Date().getMinutes()}`,
                        date: "Just now",
                        active: true
                    });
                    updateHistoryList();
                }
            });
            
            // Close history sidebar
            closeHistoryBtn.addEventListener('click', () => {
                chatHistorySidebar.classList.remove('active');
            });
            
            // Message input
            messageInput.addEventListener('input', autoResizeTextarea);
            messageInput.addEventListener('keydown', (e) => {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendMessage();
                }
                
                // Auto-resize as user types
                autoResizeTextarea();
            });
            
            // Send button
            sendButton.addEventListener('click', sendMessage);
            
            // Attach file button
            attachFileBtn.addEventListener('click', () => {
                // Create a file input element
                const fileInput = document.createElement('input');
                fileInput.type = 'file';
                fileInput.accept = '.pdf,.jpg,.jpeg,.png,.txt,.doc,.docx';
                fileInput.style.display = 'none';
                fileInput.addEventListener('change', handleFileSelect);
                
                // Trigger file selection
                document.body.appendChild(fileInput);
                fileInput.click();
                
                // Clean up
                setTimeout(() => {
                    document.body.removeChild(fileInput);
                }, 100);
            });
            
            // Emoji picker
            emojiPickerBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                emojiPicker.classList.toggle('active');
            });
            
            // Close emoji picker when clicking outside
            document.addEventListener('click', (e) => {
                if (!emojiPicker.contains(e.target) && e.target !== emojiPickerBtn) {
                    emojiPicker.classList.remove('active');
                }
            });
            
            // Copy chat button
            copyChatButton.addEventListener('click', copyChatToClipboard);
            
            // File preview modal
            previewCloseBtn.addEventListener('click', () => {
                filePreviewModal.classList.remove('active');
            });
            
            closePreviewBtn.addEventListener('click', () => {
                filePreviewModal.classList.remove('active');
            });
            
            downloadPreviewBtn.addEventListener('click', () => {
                showTemporaryNotification("Download started (simulated)");
                setTimeout(() => {
                    filePreviewModal.classList.remove('active');
                }, 500);
            });
            
            // Close modal when clicking outside
            filePreviewModal.addEventListener('click', (e) => {
                if (e.target === filePreviewModal) {
                    filePreviewModal.classList.remove('active');
                }
            });
            
            // Close history sidebar when clicking outside on mobile
            document.addEventListener('click', (e) => {
                if (window.innerWidth <= 1100 && 
                    !chatHistorySidebar.contains(e.target) && 
                    !themeToggle.contains(e.target) && 
                    !document.querySelector('.theme-options').contains(e.target) &&
                    chatHistorySidebar.classList.contains('active')) {
                    
                    // Don't close if clicking on the theme toggle area
                    const themeToggleArea = document.querySelector('.theme-toggle-wrapper');
                    if (!themeToggleArea.contains(e.target)) {
                        chatHistorySidebar.classList.remove('active');
                    }
                }
            });
            
            // Initialize auto-resize
            autoResizeTextarea();
        }
        
        // ===== INITIALIZATION =====
        function initializeApp() {
            initializeTheme();
            initializeEmojiPicker();
            initializeEventListeners();
            
            // Show a welcome notification
            setTimeout(() => {
                showTemporaryNotification("Welcome to the ISTARC-inspired chat interface!");
            }, 1000);
            
            // Add sample file attachment click handlers
            document.querySelectorAll('.file-attachment').forEach(attachment => {
                attachment.addEventListener('click', function() {
                    const fileName = this.getAttribute('data-file');
                    const fileSize = this.getAttribute('data-size');
                    
                    previewFile({
                        name: fileName,
                        size: fileSize,
                        type: getFileType(fileName)
                    });
                });
            });
        }
        
        // Start the app when the page loads
        document.addEventListener('DOMContentLoaded', initializeApp);
    </script>
</body>
</html>